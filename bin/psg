#!/bin/bash

count=0
threads=0

function usage
{
	echo "$(basename $0) [-ct] <pattern>"
	echo
	echo "-c  =>  Print only the count of records returned"
	echo "-t  =>  Display all threads matching <pattern>"
	echo "<pattern> => This is a grep extended regular expression"
	echo
}

while getopts ":ct" opt
do
	case $opt in
		c)
			count=1
			;;
		t)
			threads=1
			;;
		\?)
			usage
			exit 2
			;;
		:)
			usage
			exit 2
			;;
	esac
done

shift $((OPTIND-1))

if (( $# != 1 ))
then
	usage
	exit
fi

if (( $count == 1 && $threads == 1 ))
then
	usage
	exit
fi

if (( $count == 0 && $threads == 0 ))
then
	ps -ax -o uid,user,pid,ppid,%cpu,%mem,command 2>/dev/null | grep -iE "UID|${1}" | grep -v grep | grep -v "bin\/psg" | grep -v "ps -ax" 2>/dev/null
fi

if (( $count == 1 && $threads == 0 ))
then
	echo "$(ps -ax -o uid,user,pid,ppid,%cpu,%mem,command 2>/dev/null | grep -iE "UID|${1}" | grep -v grep | grep -v "bin\/psg" | grep -v "ps -ax"  2>/dev/null | wc -l) - 1" | bc
fi

if (( $threads == 1 && $count == 0 ))
then
	ps -eLf | grep -iE "${1}"
fi

